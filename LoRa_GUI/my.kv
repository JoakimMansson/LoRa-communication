WindowManager:

    MainScreen:
    DataDetailsScreen:


<MainScreen>:
    name: "Main"
    size: root.width, root.height

    lightMode: LightMode

    packCurrent: PackCurrent
    packVoltage: PackVoltage
    avgPackCurrent: AvgPackCurrent
    packStateOfHealth: PackStateOfHealth
    packStateOfCharge: StateOfCharge
    lowCellVoltage: LowCellVoltage
    highCellVoltage: HighCellVoltage
    avgCellVoltage: AvgCellVoltage
    voltageFailsafeActive: VoltageFailsafeActive
    currentFailsafeActive: CurrentFailsafeActive
    relayFailsafeActive: RelayFailsafeActive
    cellBalancingActive: CellBalancingActive
    changeinterlockFailsafeActive: ChangeinterlockFailsafeActive
    thermistorB_valueTableInvalid: ThermistorB_valueTableInvalid
    inputPowerSupplyFailed: InputPowerSupplyFailed
    highestTemperature: HighestTemperature
    lowestTemperature: LowestTemperature
    averageTemperature: AverageTemperature
    internalTemperature: InternalTemperature
    busCurrent: BusCurrent
    busVoltage: BusVoltage
    heatsinkTemperature: HeatsinkTemperature
    motorTemperature: MotorTemperature
    motorVelocity: MotorVelocity
    vehicleVelocity: VehicleVelocity
    motorOverSpeed: MotorOverSpeed
    desaturationFault: DesaturationFault
    railUnderVoltage: RailUnderVoltage
    configReadError: ConfigReadError
    watchdogCausedLastReset: WatchdogCausedLastReset
    badMotorPositionHallSequence: BadMotorPositionHallSequence
    dCBusOverVoltage: DCBusOverVoltage
    softwareOverCurrent: SoftwareOverCurrent
    hardwareOverCurrent: HardwareOverCurrent
    iPMTemperatureOrMotorTemperature: IPMTemperatureOrMotorTemperature
    busVoltageLowerLimit: BusVoltageLowerLimit
    busVoltageUpperLimit: BusVoltageUpperLimit
    busCurrentLimit: BusCurrentLimit
    velocity: Velocity
    motorCurrent: MotorCurrent
    outputVoltagePWM: OutputVoltagePWM


    MDFloatLayout:
        #md_bg_color: (0,0,0,1)

        MDRoundFlatIconButton:
            id: LightMode
            text: "Darkmode"
            icon: "weather-night"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.02, "y":0.92}
            on_release: root.switch_mode()

        GridLayout:
            size: root.width, root.height
            pos_hint: {"x": -0.36, "y": 0}
            row_force_default: True
            row_default_height: 40
            padding: ["50sp", "50sp"]
            cols: 1
            rows: 10

#------------------ BMS PACK -------------------#

            MDLabel:
                text: "BMS_Pack"
                font_size: "20sp"
                bold: True
            

            Label:
                id: PackCurrent
                text: "Pack_Current"
                font_size: "15sp"

            Label:
                id: PackVoltage
                text: "Pack_Voltage"
                font_size: "15sp"

            Label:
                id: AvgPackCurrent
                text: "Avg_Pack_Current"
                font_size: "15sp"

            Label:
                id: PackStateOfHealth
                text: "Pack_SOH"
                font_size: "15sp"

            Label:
                id: StateOfCharge
                text: "SOC"
                font_size: "15sp"

#------------------ BMS CELL -------------------#

            Label:
                text: "BMS_Cell"
                font_size: "20sp"
                bold: True

            Label:
                id: LowCellVoltage
                text: "Low_Cell_Voltage"
                font_size: "15sp"

            Label:
                id: HighCellVoltage
                text: "High_Cell_Voltage"
                font_size: "15sp"

            Label:
                id: AvgCellVoltage
                text: "Avg_Cell_Voltage"
                font_size: "15sp"
            


        GridLayout:
            size: root.width, root.height
            pos_hint: {"x": -0.18, "y": 0}
            row_force_default: True
            row_default_height: 40
            padding: ["50sp", "50sp"]
            cols: 1
            rows: 13

#------------------ BMS FAILSAFES -------------------#

            Label:
                text: "BMS_Failsafes"
                font_size: "20sp"
                bold: True

            Label:
                id: VoltageFailsafeActive
                text: "Voltage_Failsafe_Active"
                font_size: "15sp"

            Label:
                id: CurrentFailsafeActive
                text: "Current_Failsafe_Active"
                font_size: "15sp"

            Label:
                id: RelayFailsafeActive
                text: "Relay_Failsafe_Active"
                font_size: "15sp"

            Label:
                id: CellBalancingActive
                text: "Cell_Balancing_Active"
                font_size: "15sp"

            Label:
                id: ChangeinterlockFailsafeActive
                text: "Change_Interlock_Failsafe_Active"
                font_size: "15sp"

            Label:
                id: ThermistorB_valueTableInvalid
                text: "ThermistorB_valueTable_Invalid"
                font_size: "15sp"

            Label:
                id: InputPowerSupplyFailed
                text: "Input_Power_Supply_Failed"
                font_size: "15sp"


    #------------------ BMS TEMPERATURES -------------------#

            Label:
                text: "BMS_Temperatures"
                font_size: "20sp"
                bold: True

            Label:
                id: HighestTemperature
                text: "Highest_Temp"
                font_size: "15sp"

            Label:
                id: LowestTemperature
                text: "Lowest_Temp"
                font_size: "15sp"

            Label:
                id: AverageTemperature
                text: "Average_Temp"
                font_size: "15sp"

            Label:
                id: InternalTemperature
                text: "Internal_Temp"
                font_size: "15sp"



        
        GridLayout:
            size: root.width, root.height
            pos_hint: {"x": 0, "y": 0}
            row_force_default: True
            row_default_height: 40
            padding: ["50sp", "50sp"]
            cols: 1
            rows: 9

#------------------ MC CURRENT & VOLTAGE -------------------#

            Label:
                text: "MC_Current_Voltage"
                font_size: "20sp"
                bold: True

            Label:
                id: BusCurrent
                text: "Bus_Current"
                font_size: "15sp"

            Label:
                id: BusVoltage
                text: "Bus_Voltage"
                font_size: "15sp"


    #------------------ MC TEMPERATURES -------------------#

            Label:
                text: "MC_Temperatures"
                font_size: "20sp"
                bold: True

            Label:
                id: HeatsinkTemperature
                text: "Heatsink_Temp"
                font_size: "15sp"

            Label:
                id: MotorTemperature
                text: "Motor_Temp"
                font_size: "15sp"


    #------------------ MC Velocity -------------------#

            Label:
                text: "MC_Velocity"
                font_size: "20sp"
                bold: True

            Label:
                id: MotorVelocity
                text: "Motor_Velocity"
                font_size: "15sp"

            Label:
                id: VehicleVelocity
                text: "Vehicle_Velocity"
                font_size: "15sp"


        
        GridLayout:
            size: root.width, root.height
            pos_hint: {"x": 0.18, "y": 0}
            row_force_default: True
            row_default_height: 40
            padding: ["50sp", "50sp"]
            cols: 1
            rows: 18

#------------------ MC ERRORFLAGS -------------------#

            Label:
                text: "MC_Error_Flags"
                font_size: "20sp"
                bold: True

            Label:
                id: MotorOverSpeed
                text: "Motor_Over_Speed"
                font_size: "15sp"

            Label:
                id: DesaturationFault
                text: "Desaturation_Fault"
                font_size: "15sp"

            Label:
                id: RailUnderVoltage
                text: "Rail_Under_Voltage"
                font_size: "15sp"

            Label:
                id: ConfigReadError
                text: "Config_Read_Error"
                font_size: "15sp"

            Label:
                id: WatchdogCausedLastReset
                text: "Watchdog_Caused_Last_Reset"
                font_size: "15sp"

            Label:
                id: BadMotorPositionHallSequence
                text: "Bad_Motor_Position_Hall_Sequence"
                font_size: "15sp"

            Label:
                id: DCBusOverVoltage
                text: "DC_Bus_Over_Voltage"
                font_size: "15sp"

            Label:
                id: SoftwareOverCurrent
                text: "Software_Over_Current"
                font_size: "15sp"

            Label:
                id: HardwareOverCurrent
                text: "Hardware_Over_Current"
                font_size: "15sp"


        
        GridLayout:
            size: root.width, root.height
            pos_hint: {"x": 0.36, "y": 0}
            row_force_default: True
            row_default_height: 40
            padding: ["50sp", "50sp"]
            cols: 1
            rows: 18

#------------------ MC LIMITFLAGS -------------------#

            Label:
                text: "MC_Limit_Flags"
                font_size: "20sp"
                bold: True

            Label:
                id: IPMTemperatureOrMotorTemperature
                text: "IPM_OR_MOTOR_TEMP"
                font_size: "15sp"

            Label:
                id: BusVoltageLowerLimit
                text: "Bus_Voltage_Lower_Limit"
                font_size: "15sp"

            Label:
                id: BusVoltageUpperLimit
                text: "Bus_Voltage_Upper_Limit"
                font_size: "15sp"

            Label:
                id: BusCurrentLimit
                text: "Bus_Current_Limit"
                font_size: "15sp"

            Label:
                id: Velocity
                text: "Velocity"
                font_size: "15sp"

            Label:
                id: MotorCurrent
                text: "Motor_Current"
                font_size: "15sp"

            Label:
                id: OutputVoltagePWM
                text: "Output_Voltage_PWM"
                font_size: "15sp"
        

        Image:
            source: "HUST_logo.png"
            size_hint: (1.0, 0.17)
            pos_hint: {"x": 0, "y": 0.02}


        MDRoundFlatIconButton:
            text: "LoRa status"
            icon: "satellite-uplink"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.02, "y":0.02}
            on_release: root.show_lora_status()


        MDRoundFlatIconButton:
            text: "Data details"
            icon: "database"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.14, "y":0.02}
            on_release: 
                root.manager.transition.direction = "left"
                root.manager.current = "DataDetails"

        MDRoundFlatIconButton:
            text: "Good"
            icon: "circle"
            #icon_color: (0/255, 109/255, 176/255, 1)
            text_color: "white"
            line_color: (0,0,0,0)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.90, "y":0.06}
        
        MDRoundFlatIconButton:
            text: "Bad"
            icon: "circle"
            #icon_color: (176/255, 18/255, 0/255, 1)
            text_color: "white"
            line_color: (0,0,0,0)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.90, "y":0.02}



<DataDetailsScreen>:
    name: "DataDetails"
    size: root.width, root.height

    sortedBTN: SortOrder
    dateBTN: DateRange

    MDFloatLayout:
        #md_bg_color: (0,0,0,1)



        MDRoundFlatIconButton:
            text: "All data"
            icon: "arrow-left-top"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.04, "y":0.02}
            on_release: 
                root.manager.transition.direction = "right"
                root.manager.current = "Main"

        MDRoundFlatIconButton:
            id: DateRange
            text: "Date range: all-time"
            icon: "all-inclusive"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.47, "y":0.85}
            on_release: root.switch_date_range()

        MDRoundFlatIconButton:
            id: SortOrder
            text: "Sorted: descending"
            icon: "arrow-down"
            #icon_color: "white"
            text_color: "white"
            line_color: (0/255, 109/255, 176/255)
            size_hint: (0.1, 0.05)
            pos_hint: {"x": 0.63, "y":0.85}
            on_release: root.switch_sort()

        Image:
            source: "HUST_logo.png"
            size_hint: (1.0, 0.17)
            pos_hint: {"x": -0.38, "y": 0.82}

        

        ScrollView:
            do_scroll_y: True
            do_scroll_x: False
            size_hint:(0.18, 0.6)
            pos_hint: {"x": 0.05, "y":0.2}
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "1800sp"
                
                #--------BMS PACK---------#
                MDRectangleFlatButton:
                    text: "BMS_PACK"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"
                    

                MDRectangleFlatIconButton:
                    icon: "battery"
                    text: "Pack_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(10)

                MDRectangleFlatIconButton:
                    icon: "battery"
                    text: "Pack_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(11)

                MDRectangleFlatIconButton:
                    icon: "battery"
                    text: "Avg_Pack_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(13)

                MDRectangleFlatIconButton:
                    icon: "battery-heart"
                    text: "Pack_SOH"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(12)

                MDRectangleFlatIconButton:
                    icon: "battery-charging-90"
                    text: "Pack_SOC"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(14)

                #--------BMS CELL---------#
                MDRectangleFlatButton:
                    text: "BMS_CELL"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "battery-charging-low"
                    text: "Low_Cell_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(15)

                MDRectangleFlatIconButton:
                    icon: "battery-charging-high"
                    text: "High_Cell_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(16)

                MDRectangleFlatIconButton:
                    icon: "battery-charging-50"
                    text: "Avg_Cell_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(17)

                #--------BMS FAILSAFES---------#
                MDRectangleFlatButton:
                    text: "BMS_FAILSAFES"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "Voltage_Failsafe_Active"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(18)

                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "Current_Failsafe_Active"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(19)

                MDRectangleFlatIconButton:
                    icon: "alert-circle"
                    text: "Relay_Failsafe_Active"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(20)
                
                MDRectangleFlatIconButton:
                    icon: "battery-minus-variant"
                    text: "Cell_Balancing_Active"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(21)
                
                MDRectangleFlatIconButton:
                    icon: "alert-circle"
                    text: "Change_Interlock_Failsafe_Active"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(22)

                MDRectangleFlatIconButton:
                    icon: "power-plug-off"
                    text: "Input_Power_Supply_Failed"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(24)
                
                #--------BMS TEMPERATURES---------#
                MDRectangleFlatButton:
                    text: "BMS_TEMPERATURES"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "thermometer-plus"
                    text: "Highest_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(25)

                MDRectangleFlatIconButton:
                    icon: "thermometer-minus"
                    text: "Lowest_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(26)

                MDRectangleFlatIconButton:
                    icon: "thermometer-auto"
                    text: "Average_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(27)

                MDRectangleFlatIconButton:
                    icon: "thermometer-lines"
                    text: "Internal_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(28)

                #--------MC CURRENT & VOLTAGE---------#
                MDRectangleFlatButton:
                    text: "MC_Current_Voltage"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "flash-auto"
                    text: "Bus_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(31)

                MDRectangleFlatIconButton:
                    icon: "flash"
                    text: "Bus_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(32)
                
                #--------MC TEMPERATURES---------#
                MDRectangleFlatButton:
                    text: "MC_TEMPERATURES"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "temperature-celsius"
                    text: "Motor_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(30)

                MDRectangleFlatIconButton:
                    icon: "thermometer-lines"
                    text: "Heatsink_Temperature"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(29)

                #--------MC VELOCITY---------#
                MDRectangleFlatButton:
                    text: "MC_VELOCITY"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "engine-outline"
                    text: "Motor_Velocity"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(33)

                MDRectangleFlatIconButton:
                    icon: "car-cruise-control"
                    text: "Vehicle_Velocity"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(34)


                #--------MC ERRORFLAGS---------#
                MDRectangleFlatButton:
                    text: "MC_Error_Flags"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "engine-outline"
                    text: "Motor_Over_Speed"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(35)

                MDRectangleFlatIconButton:
                    icon: "alert-circle"
                    text: "Desaturation_Fault"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(36)

                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "Rail_Under_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(37)

                MDRectangleFlatIconButton:
                    icon: "alert-circle"
                    text: "Config_Read_Error"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(38)

                MDRectangleFlatIconButton:
                    icon: "dog-side"
                    text: "Watchdog_Caused_Last_Reset"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(39)

                MDRectangleFlatIconButton:
                    icon: "engine"
                    text: "Bad_Motor_Position_Hall_Sequence"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(40)
                
                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "DC_Bus_Over_Voltage"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(41)

                MDRectangleFlatIconButton:
                    icon: "current-ac"
                    text: "Software_Over_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(42)

                MDRectangleFlatIconButton:
                    icon: "current-ac"
                    text: "Hardware_Over_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(43)

                #--------MC LIMITFLAGS---------#
                MDRectangleFlatButton:
                    text: "MC_Limit_Flags"
                    text_color: (0/255, 109/255, 176/255)
                    line_color: "white"

                MDRectangleFlatIconButton:
                    icon: "thermometer-alert"
                    text: "IPM_OR_MOTOR_TEMP"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(44)

                MDRectangleFlatIconButton:
                    icon: "battery-minus-outline"
                    text: "Bus_Voltage_Lower_Limit"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(45)

                MDRectangleFlatIconButton:
                    icon: "battery-minus"
                    text: "Bus_Voltage_Upper_Limit"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(46)

                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "Bus_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(47)

                MDRectangleFlatIconButton:
                    icon: "speedometer-slow"
                    text: "Velocity"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(48)

                MDRectangleFlatIconButton:
                    icon: "current-ac"
                    text: "Motor_Current"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(49)
                
                MDRectangleFlatIconButton:
                    icon: "flash-triangle"
                    text: "Output_Voltage_PWM"
                    text_color: "white"
                    line_color: "white"
                    on_release: root.display_data(50)


        





